<!DOCTYPE html>
<html>
<head>
    <title>Exemplo MQTT</title>
    
   
</head>
<body>
    <h1>Envio de Mensagem MQTT</h1>
    <button id="enviar">Enviar Mensagem MQTT</button>
    
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mqtt/4.11.0/mqtt.min.js"></script>
    <script>
       
        console.log('MQTT');

function enviarParaMQTT() {
    console.log('Entrou na função enviarParaMQTT'); // Mensagem de depuração

    const redValue = "2";

    // Configurar a conexão com o servidor MQTT
    const client = mqtt.connect('m@broker.emqx.io:8083'); // Use um servidor MQTT compatível com conexão segura (WebSocket)

    client.on('connect', function () {
        console.log('Conectado ao servidor MQTT');
        const message = redValue;

        // Publicar a mensagem no tópico desejado
        client.publish('ifce', message, function (err) {
            if (!err) {
                console.log('Mensagem enviada com sucesso.');
            } else {
                console.error('Erro ao enviar mensagem: ' + err);
            }
            client.end(); // Encerra a conexão após a publicação
        });
    });

    client.on('error', function (err) {
        console.error('Erro de conexão: ' + err);
    });
}
        
        document.addEventListener("DOMContentLoaded", function () {
            const enviarButton = document.getElementById("enviar");
            enviarButton.addEventListener("click", function () {
                enviarParaMQTT(); // Chama a função quando o botão é clicado
            });
        });

        
    </script>
</body>
</html>
